<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <title>
      Velryb√°rio
    </title>
    <script type="text/javascript" src="js/elm.js"></script>
  </head>
  <body>
  </body>
  <script type="text/javascript">
    var app = Elm.Main.embed(document.body);

    let wPressed = false;
    let sPressed = false;
    let oPressed = false;
    let kPressed = false;

    document.body.addEventListener('keydown', (ev) => {
      if (ev.keyCode === 87) { // w
        wPressed = true;
      } else if (ev.keyCode === 83) { // s
        sPressed = true;
      } else if (ev.keyCode === 79) { // o
        oPressed = true;
      } else if (ev.keyCode === 75) { // k
        kPressed = true;
      }
    });

    document.body.addEventListener('keyup', (ev) => {
      if (ev.keyCode === 87) { // w
        wPressed = false;
      } else if (ev.keyCode === 83) { // s
        sPressed = false;
      } else if (ev.keyCode === 79) { // o
        oPressed = false;
      } else if (ev.keyCode === 75) { // k
        kPressed = false;
      }
      if (ev.keyCode === 32 || ev.keyCode === 13 || ev.keyCode === 27) {
        app.ports.retryGame.send(0);
      }
    });

    app.ports.startLoop.subscribe(() => {
      window.setInterval(function() {
        window.requestAnimationFrame(() => {
          app.ports.roundToPlay.send({
            wPressed,
            sPressed,
            oPressed,
            kPressed
          });
        });
      }, 20);
    });
  </script>
</html>
